<br>

<p align="center">
<img width="500" src="https://github.com/user-attachments/assets/d2f4710d-b177-40c5-b216-bf0930ff8982" alt="Microsoft Active Directory Logo"/>
<br>

<br>

<h1 align="center">Vulnerability Management Lifecycle with Azure & OpenVAS</h1>

<br>

<h2>Description</h2>

Following our previous project where we built a [Vulnerability Management Lab in the Cloud](https://github.com/franciscovfonseca/Vulnerability-Management-Lab/blob/main/README.md), we're now going to implement a full Vulnerability Management Process within an organization.

The objective of this project is to demonstrate the complete Vulnerability Management Lifecycle using a vulnerable Azure Virtual Machine.

We'll go through each of the Vulnerability Management Steps which include:

<p align="center">
<img src="https://github.com/user-attachments/assets/f90758d4-7b51-4c33-a44f-5ef0931fa474" height="70%" width="70%" alt="Image Analysis Dataflow"/>

<br>

<br>

<details close> 
<summary> <h2>Technologies & Softwares Employed</h2> </summary>

<br>

- **OpenVAS** - Vulnerability Management Server
- **Microsoft Azure** - A Virtual Machine that contains multiple Vulnerable Softwares & has Firewall Rules turned OFF
- Old Version of **Adobe Reader**: 10.0_AdbeRdr1000_en_US_1
- Old Version of **VLC Player**: vlc-1.1.7-win32
- Old Version of **Firefox**: Firefox Setup 97.0b5

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>1️⃣ Discovery</h2> </summary>
<br>

> This is the initial stage where the organization identifies and documents all the Assets within its network.
> 
> It involves creating an inventory of all hardware, software and network resources.
> 
> This step is crucial because we can't protect what we don't know we own.

<br>

➡️ In this project we are going to **Identify & Document** the configurations of our **Vulnerable Azure Virtual Machine**.

<br>

- **VM Name:** ```Win10VulnMan```
- **Subscription:** ```Azure Subscription 1```
- **Resource Group:** ```Vulnerability_Management_VM```
- **Location:** ```East-US```
- **OS:** ```Windows 10 Pro```
- **Size:** ```Standard_D4s_v3```
- **Virtual Network/Subnet:** ```OpenVasVM-vnet/default```
- **Public IP address:** ```172.210.64.150```
- **Open Ports:** ```3389``` for Windows Remote Connection
- **Installed Software and Applications:** VLC Media Player + Mozilla Firefox + Adobe PDF Reader


<br>

<p align="center">
<img src="https://i.imgur.com/XUto5rL.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>2️⃣ Prioritize</h2> </summary>
<br>

Once we've identified all of our assets, the next step is to prioritize them based on their:

  - Criticality to the Business
  - Data Sensitivity
  - Potential Impact if Compromised

<br>

This helps us focus our efforts in the most crucial areas first.

Given that our only asset in Azure is the Virtual Machine, we'll consider a hypothetical scenario where this VM plays a vital role in business operations.

If this asset became compromised, there would be a significant impact on the organization, and we'd require immediate action to restore its functionality.

In this scenario it would be best to assign it a **High Priority Status**.

For all other scenarios ➔ we can use a **Priority Matrix** to determine what priority we should assign to each asset.

<br>

<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/6d6ec167-e5ba-487f-8228-29c26a4268c5" height="85%" width="85%" alt="Image Analysis Dataflow"/>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>3️⃣ Assess</h2> </summary>
<br>

In this phase, the identified assets are scanned and assessed for vulnerabilities.

This involves using automated tools to scan for known vulnerabilities and manually assessing the systems for potential security weaknesses.

The assessment should be comprehensive, covering both technical vulnerabilities and system misconfigurations

<br>

We will conduct both non-credentialed and credentialed scans.

The non-credentialed scan will identify vulnerabilities visible to an attacker without system access, offering insight into external threats.

The credentialed scan provides a thorough assessment of all potential vulnerabilities, simulating an attacker with complete system access.

<br>

<br>

To do this, we will be utilizing OpenVAS/Greenbone Edition.

This is a vulnerability management server that you can set up in Microsoft Azure to conduct vulnerability scans on virtual machine.

To get the server up we will need to login to it using SSH through either PowerShell or the Linux Terminal.

Once the server is up we can login into it and set up a non-credentialed scan.

***(Note: Make sure that the virtual machine and the OpenVAS server are in the same vnet. Otherwise this scan will not work)***
<br />

<br />
<br />

<p align="center">
<img src="https://i.imgur.com/kl8Ysdt.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/F8GxRdi.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/TSet67t.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>


<br />
Steps to create a non-credentialed scan: 

- **Login to OpenVAS → Assets → Hosts → New Host**
  - Add the Client VM PRIVATE IP Address
- **Create a New Target from the Host, name it “Azure Vulnerable VMs”.**
  - Take note of the credentials. We will add SMB credentials later.
- **Scans→ Tasks → Create a new Task**
  - Name & Comment: “Scan - Azure Vulnerable VMs”
  - Scan Targets: “Azure Vulnerable VMs”
  - Save the Task
- **Start the scan** - Azure Vulnerable VMs” Task


<br />

<p align="center">
<img src="https://i.imgur.com/6kpLrwj.png****" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/YRvDBlJ.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>


<br />
Steps to create a credentialed scan: 

- **Go to Configuration → Credentials → New Credential**
  - **Name / Comment:** “Azure VM Credentials”
  - **Allow Insecure Use:** Yes
  - **Username:** azureuser
  - **Password:** Cyberlab123!
  - Save
- **Go to Configuration → Targets → CLONE the Target we made before**
  - **NEW Name / Comment:** “Azure Vulnerable VMs - Credentialed Scan”
  - Ensure the Private IP is still accurate
  - **Credentials → SMB → Select the Credentials we just made:** Azure VM Credentials
  - Save
-  **Start Credentialed Scan**

<br />

<p align="center">
<img src="https://i.imgur.com/vvxx0vs.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/KjLkRTE.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<br />
Once the scans have completed it should look something like this:
<br />

<br />
<br />



<p align="center">
<img src="https://i.imgur.com/O2LvBhS.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>4️⃣ Report</h2> </summary>
<br>

Reporting involves documenting the findings from the assessment phase. This includes details about the identified vulnerabilities, their severity, and the potential impact on the organization. Reporting provides a clear picture of the current security posture and is vital for decision-making and compliance purposes.
<br />

<br />
Let's review the report for the non-credentialed scan. It looks like the non-credentialed scan only returned 3 results. This is expected because the vulnerability scanner only had outside access to the system so it only returned a few results.
<br />

<br />
<br />

<p align="center">
<img src="https://i.imgur.com/Tp36Ewn.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br />
Now let's take a look at the report for the credentialed scan. As we can see the credentialed scan returned a significant amount more results than the non-credentialed scan. Most of these results look to be associated with 3 programs that are installed on the VM: VLC Media Player, Adobe Reader, and Mozilla Firefox.
<br />

<br />
<br />

<p align="center">
<img src="https://i.imgur.com/HHjbJWy.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>5️⃣ Remediate</h2> </summary>
<br>

Remediation is the process of fixing the vulnerabilities. This can involve patching software, applying security updates, changing configurations, or even replacing vulnerable systems. The goal is to eliminate or reduce the risk posed by the vulnerabilities.
<br />

<br />
Let's start by remediating the vulnerabilities with the highest severity levels. It looks like the cause for a good portion of these vulnerabilities is outdated software. To remediate this we will simply log into the virtual machine and either update/uninstall the software for VLC Media Player, Adobe Reader, and Mozilla Firefox. Since these programs are not required for performing normal business operations we will simply remove them.
<br />


<br />
<br />


<p align="center">
<img src="https://i.imgur.com/EhQQcaB.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br />
For the rest of the vulnerabilities (The vulnerabilities within the non-credentialed scan) it looks like remediating these vulnerabilities will affect the connectivity to the virtual machine. This is an issue because as we established earlier this is a critical asset required for normal business operations. In instances like these, where we cannot directly remediate the vulnerabilities, we would turn to implementing compensating security controls. We can do this by ensuring our vnet configuration is secured, our firewall and antivirus are turned on within our virtual machine, and that our security posture for this resource group is secured.
<br />

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>6️⃣ Verify</h2> </summary>
<br>

The final stage is to verify that the vulnerabilities have been successfully remediated. This involves re-assessing the previously identified vulnerabilities to ensure they are no longer present or pose a risk. Verification ensures that the remediation efforts were effective and helps to close the vulnerability management loop.
<br />

<br />
We will do this by rescanning our virtual machine and comparing the results for both credentialed and non-credentialed scans. As we can see, compared to the first report, there are now fewer vulnerabilities present. The only vulnerabilities present now are the vulnerabilities where we determine we could not remediate directly and instead implemented proper security controls.
<br />

<br />
<br />


<p align="center">
<img src="https://i.imgur.com/MiUCvvl.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br>

<h2></h2>

  </details>

<br>

<br>

<br>

<h1>Conclusion</h1>

<br />
Finally, we have successfully navigated the vulnerability management lifecycle within a Microsoft Azure environment. The project encompassed the core stages of Discovery, Prioritization, Assessment, Reporting, Remediation, and Verification, using a vulnerable virtual machine.
<br />
