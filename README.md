<br>

<p align="center">
<img width="500" src="https://github.com/user-attachments/assets/d2f4710d-b177-40c5-b216-bf0930ff8982" alt="Microsoft Active Directory Logo"/>
<br>

<br>

<h1 align="center">Vulnerability Management Lifecycle with Azure</h1>

<br>

<h2>Description</h2>

<br>

Following our previous project where we built a [Vulnerability Management Lab in the Cloud](https://github.com/franciscovfonseca/Vulnerability-Management-Lab/blob/main/README.md), we're now going to implement a full Vulnerability Management Process within an organization.

The objective of this project is to demonstrate the complete Vulnerability Management Lifecycle using a vulnerable Azure Virtual Machine.

We'll go through each of the Vulnerability Management Steps which include:

<p align="center">
<img src="https://github.com/user-attachments/assets/f90758d4-7b51-4c33-a44f-5ef0931fa474" height="70%" width="70%" alt="Image Analysis Dataflow"/>

<br>

<br>

<h2>Technologies & Software Employed</h2>

<br>

- **OpenVAS** - Vulnerability Management Server
- **Microsoft Azure** - A Virtual Machine that contains multiple Vulnerable Softwares & has Firewall Rules turned OFF
- Old Version of **Adobe Reader**: 10.0_AdbeRdr1000_en_US_1
- Old Version of **VLC Player**: vlc-1.1.7-win32
- Old Version of **Firefox**: Firefox Setup 97.0b5

<br>

<br>

<details close> 
<summary> <h2>1Ô∏è‚É£ Discovery</h2> </summary>
<br>

This is the initial stage where the organization identifies and documents all the Assets within its network.

It involves creating an inventory of all hardware, software and network resources.

üí° This step is crucial because we can't protect what we don't know we have.

<br>

‚û°Ô∏è In this project we are going to **Identify & Document** the configurations of our **Vulnerable Azure Virtual Machine**.

<br>

- **VM Name:** ```Win10VulnMan```
- **Subscription:** ```Azure Subscription 1```
- **Resource Group:** ```Vulnerability_Management_VM```
- **Location:** ```East-US```
- **OS:** ```Windows 10 Pro```
- **Size:** ```Standard_D4s_v3```
- **Virtual Network/Subnet:** ```OpenVasVM-vnet/default```
- **Public IP address:** ```172.210.64.150```
- **Open Ports:** ```3389``` for Windows Remote Connection
- **Installed Software and Applications:** VLC Media Player + Mozilla Firefox + Adobe PDF Reader


<br>

<p align="center">
<img src="https://i.imgur.com/XUto5rL.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>2Ô∏è‚É£ Prioritize</h2> </summary>
<br>

Once we've identified all of our assets, the next step is to prioritize them based on their:

  - Criticality to the Business
  - Data Sensitivity
  - Potential Impact if Compromised

<br>

This helps us focus our efforts in the most crucial areas first.

Given that our only asset in Azure is the Virtual Machine, we'll consider a hypothetical scenario where this VM plays a vital role in business operations.

If this asset became compromised, there would be a significant impact on the organization, and we'd require immediate action to restore its functionality.

In this scenario it would be best to assign it a **High Priority Status**.

For all other scenarios ‚ûî we can use a **Priority Matrix** to determine what priority we should assign to each asset.

<br>

<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/6d6ec167-e5ba-487f-8228-29c26a4268c5" height="85%" width="85%" alt="Image Analysis Dataflow"/>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>3Ô∏è‚É£ Assess</h2> </summary>
<br>

In this phase, we will **Scan & Assess** the identified assets for any **Vulnerabilities**.

This involves using automated tools to scan for known Vulnerabilities, while manually assessing the systems for potential security weaknesses.

The assessment should be comprehensive, addressing both **technical vulnerabilities** and **system misconfigurations**.

<br>

We will conduct both Non-Credentialed and Credentialed Scans.

1. The **Non-Credentialed Scan** will identify Vulnerabilities visible to an attacker **without system access**, offering insight into external threats.

2. The **Credentialed Scan** provides a thorough assessment of all potential Vulnerabilities, simulating an attacker **with complete system access**.

<br>

To do this, we'll use **OpenVAS**.

This is a **Vulnerability Management Server** that you can set up in Microsoft Azure to conduct vulnerability scans on Virtual Machines.

- To get the server running ‚ûî we will need to login to it using SSH through either *PowerShell* or the *Linux Terminal*.

- Once the server is running ‚ûî we can login into it and set up a Non-Credentialed Scan.

<br>

  <details close> 
  
**<summary> üí° Note</summary>**

Make sure that the Virtual Machine and the OpenVAS Server are in the same Virtual Network.

‚ö†Ô∏è Otherwise this scan will not work.

  </details>

<br>

<br>

<p align="center">
<img src="https://i.imgur.com/kl8Ysdt.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/F8GxRdi.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<p align="center">
<img src="https://i.imgur.com/TSet67t.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<br>

<h3>‚û°Ô∏è Steps to create a Non-Credentialed Scan:</h3>

<br>

Login to **OpenVAS** and navigate to **Assets** ‚ûî **Hosts** ‚ûî **New Host**.

  - Add the Client VM's ```Private IP Address```

<br>

We are also going to create a **New Target** from the Host ‚ûî Name & Comment: ```Azure Vulnerable VMs```

üí° Take note of the credentials ‚ûî we will add SMB credentials later.
 
<br>

<p align="center">
<img src="https://i.imgur.com/6kpLrwj.png****" height="85%" width="85%" alt="Image Analysis Dataflow"/>
<br>

<br>

After that we'll **Create a New Task**:
   - Name & Comment: ```Scan - Azure Vulnerable VMs```
   - Scan Targets: ```Azure Vulnerable VMs```
Save the Task.


Once our Task is created ‚ûî we can click the ‚ñ∑ play button to start our Task ```Scan - Azure Vulnerable VMs```.

<br>

<p align="center">
<img src="https://i.imgur.com/YRvDBlJ.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<br>

<h3>‚û°Ô∏è Steps to create a Credentialed Scan:</h3>

<br>

First we need to set up **Credentials**

Go to **Configuration ‚ûî Credentials ‚ûî New Credential**.

We'll set up the **New Credential** with the following details:
- Name & Comment: ```Azure VM Credentials```
- Allow Insecure Use: ```Yes```
- Username: ```azureuser```
- Password: ```Cyberlab123!```

**Save**

<br>

<p align="center">
<img src="https://i.imgur.com/vvxx0vs.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<br>

Next we're going to **Clone the Target** we made before ‚ûî then we'll **Add Credentials** to it.

Go to **Configuration** ‚ûî **Targets** ‚ûî and then **CLONE** the Target we made before ‚ûî by clicking the üêë **Sheep Icon**

Click the üìù **Edit Button** on the New Cloned Target ‚ûî **Azure Vulnerable VMs Clone 1**

<br>

We're going to set up the following details to the **New Cloned Target**:
- **NEW** Name & Comment: ```Azure Vulnerable VMs - Credentialed Scan```
- ‚ö†Ô∏è Ensure the **Private IP** is still accurate 
- **Credentials** > **SMB** ‚ûî Select the Credentials we just made: **Azure VM Credentials**

**Save**

<br>

<p align="center">
<img src="https://i.imgur.com/KjLkRTE.png" height="85%" width="85%" alt="Image Analysis Dataflow"/>
</p>

<br>

Click the ‚ñ∑ Play button to **Launch the New Credentialed Scan** ‚ûî üí° wait for it to finish, it will take a while.

<br>

‚úÖ Once the scans have completed, it should look something like this:

<br>

<p align="center">
<img src="https://i.imgur.com/O2LvBhS.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>4Ô∏è‚É£ Report</h2> </summary>
<br>

Reporting involves **Documenting the Findings** from the assessment phase.

This includes details about the identified vulnerabilities, their severity, and the potential impact on the organization.

üí° Reporting provides a clear picture of the current **Security Posture** and it is vital for **Decision Making** and for **Compliance Purposes**.

<br>

Let's review the report for the Non-Credentialed Scan:

‚û°Ô∏è It looks like the Non-Credentialed Scan only returned 3 results.

This is expected because the vulnerability scanner only had outside access to the system so it only returned a few results.

<br>

<p align="center">
<img src="https://i.imgur.com/Tp36Ewn.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>

<br>

<br>

<h2></h2>

<br>

Now let's take a look at the report for the Credentialed Scan:

‚û°Ô∏è As we can see the Credentialed Scan returned significantly more results than the non-credentialed scan.

Most of these results are associated with 3 Software Programs that are installed on the VM:
- **VLC Media Player**
- **Adobe Reader**
- **Mozilla Firefox**

<br>

<p align="center">
<img src="https://i.imgur.com/HHjbJWy.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>
</p>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>5Ô∏è‚É£ Remediate</h2> </summary>
<br>

Remediation is the process of **Fixing the Vulnerabilities**.

This can involve patching software, applying security updates, changing configurations, or even replacing vulnerable systems.

üí° The goal is to **Eliminate or Reduce the Risk** posed by the vulnerabilities.

<br>

Let's start by remediating the vulnerabilities with the **Highest Severity Levels**.

‚û°Ô∏è It looks like the cause for a good portion of these vulnerabilities is **Outdated Software**.

<br>

To remediate this we will simply log into the virtual machine ‚ûî and either update or uninstall the software for VLC Media Player, Adobe Reader and Mozilla Firefox.

Since these programs are not required for performing normal business operations ‚ûî we will simply remove them.

 <br>

<p align="center">
<img src="https://i.imgur.com/EhQQcaB.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>

<br>

<br>

For the rest of the vulnerabilities (The vulnerabilities within the non-credentialed scan):

- It looks like remediating these vulnerabilities will affect the connectivity to the virtual machine.

‚û°Ô∏è This is an issue because (as we established earlier) this is a critical asset required for normal business operations.

<br>

In instances like these, where we cannot directly remediate the vulnerabilities ‚ûî we would turn to implementing **Compensating Security Controls**.

We can do this by ensuring:

- our Virtual Network configuration is secured.
- our Firewall and Antivirus are turned on within our Virtual Machine.
- our Security Posture for this Resource Group is secured.

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>6Ô∏è‚É£ Verify</h2> </summary>
<br>

The final stage is to verify that the vulnerabilities have been **Successfully Remediated**.

This involves re-assessing the previously identified vulnerabilities to ensure they are no longer present or pose a risk.

üí° Verification ensures that the remediation efforts were effective and helps to close the vulnerability management loop.

<br>

We will do this by **Rescanning our Virtual Machine** and comparing the results for both Credentialed and Non-Credentialed Scans.

As we can see, compared to the first report ‚ûî there are now **Fewer Vulnerabilities** present.

The only vulnerabilities present now are the vulnerabilities that we determined we could not remediate directly and instead implemented proper **Security Controls**.

<br>

<br>

<p align="center">
<img src="https://i.imgur.com/MiUCvvl.png" height="100%" width="100%" alt="Image Analysis Dataflow"/>

<br>

<br>

<h2></h2>

  </details>

<br>

<br>

<br>

<h1>Conclusion</h1>

<br>

‚úÖ We have successfully navigated the vulnerability management lifecycle within a Microsoft Azure environment.

The project encompassed the core stages of Discovery, Prioritization, Assessment, Reporting, Remediation and Verification, using a Vulnerable Azure Virtual Machine.

<br>

<br>

<br>

<br>

<br>

<br>


